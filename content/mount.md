title: Работа в mount
tags: 



## Монтирование разделов. mount

**mount** — утилита командной строки в UNIX-подобных операционных системах. Применяется для монтирования  файловых систем.

**Использование**

`mount /dev/cdrom /mnt/cdrom`

  
Устройство _/dev/cdrom_ монтируется в каталог _/mnt/cdrom_, если он существует. Начиная от момента монтирования и пока пользователь не отмонтирует файловую систему (или туда не будет смонтировано что-то иное) в каталоге _/mnt/cdrom_ будет содержаться дерево каталогов устройства _/dev/cdrom_; те файлы, и подкаталоги, которые раньше находились в _/mnt/cdrom_, сохранятся, но будут недоступны до размонтирования устройства _/dev/cdrom_.

### Размонтирование командой umount

Для размонтирования достаточно указать точку монтирования или имя устройства.

`umount /dev/cdrom`

### Монтирование USB-дисков

Для распространённого случая, когда USB-диск имеет файловую систему FAT32, команда монтирования выглядит так:

`mount -t vfat -o codepage=``866``,iocharset=utf8 /dev/sda1 /mnt`

Параметр codepage необходим, чтобы имена созданных файлов корректно отображались в старых ОС (например, DOS). Если дистрибутив использует в качестве кодировки системной локали не UTF-8, то её необходимо указать в параметре iocharset так:

  

`mount -t vfat -o codepage=``866``,iocharset=koi8-r /dev/sda1 /mnt`

Реально используемую кодировку можно определить выполнив команду locale.

Полезными опциями при монтировании Flash-дисков являются sync и flush. Первая приводит к постоянному сбросу на диск буфера записи, так что данные не теряются при отсоединении flash-диска без размонтирования. Побочный эффект такого монтирования — значительное уменьшение в скорости записи. Вторая опция (доступна только в новых ядрах Linux) ведёт к сбросу буфера на диск после записи последнего файла. Это также способствует сохранению данных в случае удаления диска без размонтирования, но не приводит к падению скорости записи.

### Монтирование NTFS дисков/разделов

  

`mount -t ntfs -o noatime,users,rw,fmask=``111``,dmask=``000``,locale=ru_RU.UTF-``8`  `/dev/sda1 /mnt/win_xp`

### Монтирование образов дисков

Если имеется образ диска в виде iso-файла, то для его монтирования нужно указать параметр -o loop и, обычно, тип файловой системы -t iso9660 (необязательно) (file.iso — это имя файла образа, а /mnt/iso — точка монтирования):

  

`mount -o loop -t iso9660 file.iso /mnt/iso`

### Монтирование сетевых дисков NFS

`mount` `172.22``.``2.1``:/mnt/iso/ /mnt/iso/`

### Монтирование сетевых дисков SMB

Пример монтирования сетевых SMB-ресурсов:

`mount -t smbfs -o username=user,password=pass` `//server/dir /mnt/localdir/`

`mount -t cifs -o username=user,password=pass` `//server/dir /mnt/localdir/`

## Монтирование FTP серверов

  

`curlftpfs -v -o iocharset=UTF-``8`  `ftp:``//user:password@ftp.domain.ru/ /mnt/ftp`

### После этого, можно смонтировать каталог другого компьютера с помощью sshfs:

  

`sshfs user``@udalenniy_server``:/tmp ~/udalennaya_papka`

Для отмонтирования нужно ввести команду:

  

`fusermount -u ~/udalennaya_papka`

## Параметры монтирования

В случае необходимости при выполнении команды mount можно указать дополнительные параметры монтирования.

###Тип файловой системы

Обычно при монтировании определяется автоматически или берётся из файла конфигурации (см. ниже). Но в отдельных случаях нужно указывать тип файловой системы явно. Например при монтировании DVD диска с файловой системой UDF.

  

`mount /dev/cdrom /mnt/dvd -t udf`

Если неправильно указать тип файловой системы, то команда mount выдаст сообщение об ошибке

`mount: wrong fs type, bad option, bad superblock on /dev/cdrom,`

`missing codepage or other error`

`In some cases useful info is found in syslog -` `try`

`dmesg | tail or so`

и посоветует посмотреть в конец файла системных сообщений.

  

`Unable to identify CD-ROM format.`

В случае успешного монтирования обычно сообщается что компакт диск монтируется (по умолчанию) в режиме «только для чтения».

`mount: block device /dev/cdrom is write-``protected``, mounting read-only -o`

### Атрибуты доступа

-   Доступ «только для чтения» (ro) или на «чтение и запись» (rw)
-   Разрешение или запрещение запуска программ (noexec)

Пример 1 (для образца, взято монтирование USB диска):

`mount -t vfat -o rw,noexec,iocharset=utf8,codepage=``866`  `/dev/sda1 /mnt/usb`

Пример 2 (для образца, взято монтирование ntfs раздела с установленной Windows XP):

  

`mount -t ntfs -o noatime,users,rw,fmask=``111``,dmask=``000``,locale=ru_RU.UTF-``8`  `/dev/sda1 /mnt/win_xp`

  

Пример 3 (перемонтировать устройство с доступом на «чтение и запись» (rw))

  

`mount -o remount,rw /dev/sda2`

## mount --bind

Команда mount с ключом --bind или с коротким ключом -B применяется в системах на ядре Linux (начиная с 2.4.0) для создания синонима каталога в дереве файловой системы. К примеру, команда:

  

`mount --bind /mnt/cdrom/Files /var/ftp/cdrom`

позволит обращаться к файлам из /mnt/cdrom/Files через путь /var/ftp/cdrom, где /var/ftp/cdrom — некий уже существующий (возможно, пустой) каталог (его настоящее содержимое будет недоступно до момента размонтирования). Можно также вместо отдельной опции --bind написать -o bind, что будет иметь аналогичное действие. Также это позволяет добавить правило в файл /etc/fstab для монтирования при старте системы:

  

`/olddir /newdir none bind`

Преимуществом данного способа создания ссылок на каталоги над [символьными ссылками](https://ru.wikipedia.org/wiki/%D0%A1%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B0 "Символьная ссылка") является возможность обходить ограничения доступа к файловой системе, возникающие перед процессами, запущенными в среде [chroot](https://ru.wikipedia.org/wiki/Chroot "Chroot") или серверами, применяющими принцип chroot. Например, [FTP](https://ru.wikipedia.org/wiki/FTP "FTP")-сервер [proftpd](https://ru.wikipedia.org/wiki/Proftpd "Proftpd") делает недоступными символьные ссылки, указывающие на файлы и каталоги вне определённого каталога. Действие команды mount --bind напоминает DOS-овский [subst](https://ru.wikipedia.org/wiki/Subst "Subst").

## Список смонтированных файловых систем

При запуске команды mount без параметров выводится список смонтированных файловых систем:

`/dev/md/``5`  `on / type reiserfs (rw,noatime)`

`proc on /proc type proc (rw)`

`sysfs on /sys type sysfs (rw,nosuid,nodev,noexec)`

`udev on /dev type tmpfs (rw,nosuid)`

`devpts on /dev/pts type devpts (rw,nosuid,noexec)`

`/dev/md/``4`  `on /files type xfs (rw,noatime)`

`/dev/sda3 on /mnt/a type ext3 (rw,noatime)`

`/dev/sdd2 on /mnt/docs type reiserfs (rw,noatime)`

`shm on /dev/shm type tmpfs (rw,noexec,nosuid,nodev)`

`usbfs on /proc/bus/usb type usbfs (rw,noexec,nosuid,devmode=``0664``,devgid=``85``)`

`binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,noexec,nosuid,nodev)`

`nfsd on /proc/fs/nfs type nfsd (rw,noexec,nosuid,nodev)`

`//ax2/i on /mnt/smb type smbfs (0)`

`172.22``.``2.1``:/files on /mnt/files type nfs (rw,addr=``172.22``.``2.1``)`

В этом примере показывается много смонтированных файловых систем (ФС).

-   в первой строке сообщается, что в качестве корневой ФС выступает RAID-массив, с ФС типа reiserfs и параметрами монтирования: доступ на чтение и запись (rw) и указанием не обновлять атрибут времени последнего доступа (noatime)
-   sysfs, udev, devpts — это стандартные (для систем Linux) виртуальные ФС
-   /dev/sda3 — это раздел SATA диска
-   usbfs — это виртуальная файловая система для работы с USB устройствами
-   //ax2/i — это путь к сетевому диску SMB
-   172.22.2.1:/files — путь к сетевому диску NFS, находящемся на сервере с IP-адресом 172.22.2.1

## Файл конфигурации

**fstab** (f_ile systems table_) — один из конфигурационных файлов в UNIX-подобных системах, который содержит информацию о различных файловых системах и устройствах хранения информации компьютера; описывает, как диск (раздел) будет использоваться или как будет интегрирован в систему.

Полный путь к файлу — /etc/fstab

## Структура fstab

Каждая запись имеет следующие поля (которые разделяются пробелом или табуляцией):

<file system>        <dir>     <type>    <options> <dump>    <pass>

-   Поле, <file system> _(файловая система)_ сообщает демону монтирования файловых систем mount, что монтировать, имя монтируемого устройства.
-   Второе поле, <dir> _(директория)_, определяет путь, по которому будет смонтирована <file system>.
-   Поле <type> _(тип)_ содержит тип файловой системы монтируемого устройства. Полный список поддерживаемых систем можно просмотреть выполнив команду:

```man mount```

Самые распространённые файловые системы: ext3, ext4, ReiserFS, XFS, JFS, smbfs, ISO9660, VFAT, NTFS, swap. Ключ auto не является файловой системой, он позволяет определять, какой тип файловой системы используется, автоматически. Это удобно для съёмных устройств, дисководов и cd-дисков.


|атрибут|разшифровка|
|--|--|
|auto|Файловая система монтируется при загрузке автоматически или после выполнения команды 'mount -a'.|
|noauto|Файловая система может быть смонтирована только вручную.|
|exec|Позволяет исполнять бинарные файлы на разделе диска. Установлено по умолчанию.|
|noexec|Бинарные файлы не выполняются. Использование опции на корневой системе приведёт к её неработоспособности.|
|ro|Монтирует файловую систему только для чтения.|
|rw|Монтирует файловую систему для чтения/записи.|
|sync|Все операции ввода-вывода должны выполняться синхронно.|
|async|Все операции ввода-вывода должны выполняться асинхронно.|
|user|Разрешает любому пользователю монтировать файловую систему. Применяет опции noexec, nosuid, nodev, если они не переопределены.|
|nouser|Только суперпользователь может монтировать файловую систему. Используется по умолчанию.|
|defaults|Использовать значения по умолчанию. Соответствует набору rw, suid, dev, exec, auto, nouser, async.|
|suid|Разрешить операции с suid и sgid битами. В основном используются, чтобы позволить пользователям выполнять бинарные файлы со временно приобретёнными привилегиями для выполнения определённой задачи.|
|nosuid|Запрещает операции с suid и sgid битами.|
|nodev|Данная опция предполагает, что на монтируемой файловой системе не будут созданы файлы устройств (/dev). Корневой каталог и целевая директория команды chroot всегда должны монтироваться с опцией dev или defaults.|
|atime|Включает запись информации о последнем времени доступа _(atime)_ при каждом чтении файла. Включено по умолчанию на Linux до v.2.6.29 включительно.|
|noatime|Отключает запись информации о последнем времени доступа _(atime)_ при каждом чтении файла.|
|relatime|Включает запись информации о последнем времени доступа при чтении файла, если предыдущее время доступа _(atime)_ меньше времени изменения файла _(ctime)_. Включено по умолчанию на Linux начиная с v.2.6.30.|
|notail|Отключает «упаковку хвостов файлов». Опция работает только с файловой системой ReiserFS.|
| dump |- используется утилитой dump для того чтобы определить, когда делать резервную копию. После установки, dump проверяет эту запись и использует значение, чтобы решить, подключать ли файловую систему. Возможные значения 0 или 1. Если 0, dump игнорирует файловую систему, если 1, dump сделает резервную копию. У большинства пользователей dump не установлен, поэтому в поле <dump> следует задать 0.|
|pass| _(номер прохода)_. fsck проверяет число, подставленное в поле <pass> и решает, в каком порядке проверять файловую систему. Возможные значения 0, 1 и 2. Файловые системы со значением <pass>, равным 0, не будут проверены утилитой fsck. У корневой системы должен быть наибольший приоритет, 1, остальные файловые системы должны иметь приоритет 2.|




-   Следующее поле называется <options> _(опции)_. Если используются все значения по умолчанию, то используется специальный ключ defaults. Если хоть одна опция задана явно, то defaults указывать не нужно (defaults служит только для того, что была занята позиция в строке). Для полного списка опций используйте команду man mount.

Вместо указания имени устройства, можно указать UUID или метку тома, написав LABEL=<label> или UUID=<uuid>, например, `LABEL=Boot' или `UUID=3e6be9de-8139-11d1-9106-a43f08d823a6'.